# Техническое задание на проект: FireRisk Watch

## 1. Цель проекта
Создать веб-сервис, который показывает текущий и прогнозируемый уровень пожарной опасности для выбранного региона/города. Сервис автоматически получает погодные данные и данные о термоточках/пожарах из внешних API, рассчитывает риск по формуле и отображает результаты в виде таблиц и графиков.

## 2. Роли пользователей
- **Гость**: просмотр общей карты/списка регионов, просмотр страниц регионов с текущим уровнем риска и графиками.
- **Зарегистрированный пользователь**: сохранение избранных регионов, сохранение избранных запросов и истории поиска, настройка уведомлений о повышении риска (внутренние уведомления на сайте).
- **Администратор**: управление справочниками (регионы, правила расчёта риска), модерация данных, просмотр статистики.

## 3. Внешние интеграции
- **OpenWeather API**: получение текущей погоды и прогноза (температура, влажность, ветер, осадки).
- **NASA FIRMS API**: получение данных о пожарах/термоточках по географической области за период.

## 4. Модели данных (сущности)
Минимум 3 кастомные модели (фактически будет больше):

1) **Region**
- name (название региона/города)
- country (страна)
- latitude, longitude (координаты точки/центра региона)
- radius_km (радиус поиска пожаров по FIRMS)
- is_active (активен ли регион для отображения)

2) **WeatherSnapshot**
- region (ForeignKey -> Region)
- measured_at (дата/время снимка)
- temperature (float)
- humidity (int)
- wind_speed (float)
- precipitation (float, может быть 0)
- source (строка с источником/типом данных: current/forecast)

3) **FireEvent**
- region (ForeignKey -> Region)
- detected_at (дата/время события)
- latitude, longitude (координаты события)
- brightness (float/строка, если приходит как текст)
- confidence (int/строка)
- source_id (строка/уникальный идентификатор в источнике)

4) **RiskScore**
- region (ForeignKey -> Region)
- calculated_at (дата/время расчёта)
- score (int 0..100)
- level (строка: low/medium/high/critical)
- details (TextField: краткая расшифровка факторов)

5) **FavoriteRegion**
- user (ForeignKey -> User)
- region (ForeignKey -> Region)
- created_at (дата добавления)

6) **SearchHistory**
- user (ForeignKey -> User)
- query (строка запроса)
- created_at (дата/время)
- results_count (int)

## 5. Ключевой функционал (User Stories)
1) Пользователь вводит город/регион в строке поиска и получает страницу региона с текущей погодой, найденными пожарами поблизости и рассчитанным уровнем риска.
2) Пользователь открывает страницу региона и видит:
   - текущий риск (0..100) и категорию риска,
   - график динамики риска по дням за последние N дней,
   - таблицу найденных термоточек/пожаров за период.
3) Зарегистрированный пользователь добавляет регион в избранное и получает список избранных регионов в личном кабинете.
4) Зарегистрированный пользователь видит историю своих поисков и может повторить запрос в один клик.
5) Администратор через Django Admin добавляет/редактирует регионы и правила расчёта риска.

## 6. Аналитика и расчёты
- Риск рассчитывается как функция от погодных параметров и пожарной активности рядом:
  - температура (чем выше, тем больше риск),
  - влажность (чем ниже, тем больше риск),
  - скорость ветра (чем выше, тем больше риск),
  - наличие осадков (снижает риск),
  - количество событий FireEvent за последние X дней и их “уверенность/яркость”.
- Итоговый score нормируется в диапазон 0..100 и преобразуется в level (low/medium/high/critical).
- Формирование графиков производится на основе RiskScore и/или WeatherSnapshot.

## 7. Интерфейс
- Наследование шаблонов (base.html + страницы).
- Формы через Django Forms/ModelForms с серверной валидацией.
- Bootstrap (или другой CSS-фреймворк) для аккуратного и адаптивного UI.

## 8. Развертывание
- Репозиторий публичный на GitHub.
- Деплой на PythonAnywhere:
  - DEBUG=False,
  - корректные ALLOWED_HOSTS,
  - статика через collectstatic.

## 9. Изменения в ходе реализации
1) Добавлено хранение истории поисков и избранных городов:
- Модель WeatherSearch — история запросов погоды (город, время, успех/ошибка, краткий результат).
- Модель FavoriteCity — избранные города пользователя.
2) Доступ к истории/избранному будет доступен только авторизованным пользователям (планируется на следующем этапе).
3) Реализованы страницы для авторизованных пользователей: «Избранное» и «История запросов».
4) Добавлена авторизация через встроенные Django auth urls (/accounts/login/, /accounts/logout/).
5) История и избранное теперь доступны только после входа.
6) Добавлена регистрация пользователей.
7) Добавлена страница профиля пользователя.