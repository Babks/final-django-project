# Техническое задание на проект: FireRisk Watch

## 1. Цель проекта
Создать веб-сервис для оценки и визуализации пожарной опасности на основе погодных данных и активности пожаров.  
Сервис автоматически получает данные из внешних API, рассчитывает уровень риска и отображает результаты в виде таблиц, графиков и интерактивной карты.

Проект ориентирован на пользователей, которым важно понимать текущую пожарную обстановку в выбранных городах.

---

## 2. Роли пользователей
- **Гость**
  - Просмотр главной страницы
  - Поиск погоды по городу
  - Просмотр базовой информации о погоде

- **Зарегистрированный пользователь**
  - Сохранение избранных городов
  - Просмотр истории своих запросов
  - Просмотр персональной статистики
  - Просмотр ежедневных отчётов риска

- **Администратор**
  - Управление данными через Django Admin
  - Просмотр истории запросов и отчётов пользователей

---

## 3. Внешние интеграции
- **OpenWeather API**
  - Получение текущей погоды по городу
  - Температура, влажность, ветер, координаты

- **NASA FIRMS API**
  - Получение данных о термоточках в радиусе ~50 км
  - Агрегация количества и средней достоверности пожаров

---

## 4. Модели данных

### WeatherSearch
История запросов погоды.
- user (ForeignKey → User, nullable)
- city (CharField)
- created_at (DateTime)
- is_success (Boolean)
- error_message (CharField)
- temperature_c (Integer)
- humidity (Integer)
- wind_speed (Float)
- lat, lon (Float)
- risk_score (Integer)
- firms_count (Integer)
- firms_avg_confidence (Float)

---

### FavoriteCity
Избранные города пользователя.
- user (ForeignKey → User)
- city (CharField)
- created_at (DateTime)

Ограничение уникальности: *(user, city)*

---

### RiskReport
Ежедневный агрегированный отчёт по риску.
- user (ForeignKey → User)
- day (DateField)
- created_at (DateTime)
- searches (ManyToMany → WeatherSearch)
- searches_count (Integer)
- avg_risk (Integer)
- max_risk (Integer)

---

## 5. Ключевой функционал (User Stories)

1. Пользователь вводит город и получает текущую погоду и рассчитанный пожарный риск.
2. Зарегистрированный пользователь:
   - сохраняет город в избранное,
   - видит историю своих запросов,
   - повторяет поиск в один клик.
3. Пользователь просматривает статистику:
   - график температуры по истории,
   - карту рисков с маркерами городов,
   - топ городов по активности.
4. Система автоматически формирует ежедневные отчёты риска для пользователя.
5. Пользователь может просматривать список отчётов и детальную информацию по каждому дню.

---

## 6. Аналитика и расчёты

- Погодный риск рассчитывается на основе:
  - температуры,
  - влажности,
  - скорости ветра.

- Пожарная активность учитывает:
  - количество термоточек FIRMS,
  - среднюю достоверность обнаружений.

- Итоговый риск:
  - нормируется в диапазон 0–100,
  - рассчитывается как взвешенная комбинация погодного риска и FIRMS-активности.

---

## 7. Интерфейс
- Django Templates с наследованием шаблонов
- Bootstrap для адаптивного интерфейса
- Chart.js для графиков
- Leaflet + OpenStreetMap для интерактивной карты

---

## 8. Развёртывание
- Репозиторий размещён на GitHub
- Продакшн-деплой выполнен на PythonAnywhere
- DEBUG=False в продакшене
- Статика обслуживается стандартными средствами Django

---

## 9. Изменения в ходе реализации
1. Отказ от абстрактной модели Region в пользу поиска по городам через API.
2. Реализована история запросов (WeatherSearch).
3. Реализовано избранное городов (FavoriteCity).
4. Добавлена регистрация и авторизация пользователей.
5. Реализован личный кабинет пользователя.
6. Добавлена персональная статистика:
   - графики,
   - таблицы,
   - интерактивная карта.
7. Реализованы ежедневные отчёты риска (RiskReport).
8. Интегрированы OpenWeather API и NASA FIRMS API.